{% extends "base.html" %}

{% block title %}{{ _('Dashboard') }} - OpenDLP{% endblock %}

{% block content %}
<div class="govuk-width-container">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <div class="govuk-!-margin-bottom-4">
              <h1 class="govuk-heading-xl">{{ _('Dashboard') }}</h1>
              <p class="govuk-body">{{ _('Welcome back') }}, {{ current_user.display_name }}!</p>
            </div>

            <!-- User Role Info -->
            <div class="govuk-grid-row govuk-!-margin-bottom-6">
                <div class="govuk-grid-column-one-half">
                    <div class="dwp-key-details-bar">
                        <div class="dwp-key-details-bar__key-details">
                          <dt class="govuk-heading-s govuk-!-margin-bottom-2">{{ _('Your Role') }}</dt>
                            <dd class="dwp-key-details-bar__primary">
                                <strong class="govuk-tag govuk-tag--blue">{{ current_user.global_role.value }}</strong>
                            </dd>
                        </div>
                    </div>
                </div>
                <div class="govuk-grid-column-one-half">
                    <div class="dwp-key-details-bar">
                        <div class="dwp-key-details-bar__key-details">
                          <dt class="govuk-heading-s govuk-!-margin-bottom-2">{{ _('Active Assemblies') }}</dt>
                            <dd class="dwp-key-details-bar__primary">{{ assemblies|length }}</dd>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assemblies Section -->
            <div class="govuk-grid-column-full">
                <div class="govuk-!-margin-bottom-4">
                  <h2 class="govuk-heading-l">{{ _('Your Assemblies') }}</h2>
                    <a href="{{ url_for('main.assemblies') }}" class="govuk-button govuk-button--secondary">
                      {{ _('View All') }}
                    </a>
                </div>

                {% if assemblies %}
                    <div class="govuk-grid-row">
                        {% for assembly in assemblies %}
                            <div class="govuk-grid-column-one-third govuk-!-margin-bottom-4">
                                <div class="assembly-card">
                                    <h3 class="govuk-heading-m">{{ assembly.title }}</h3>
                                    {% if assembly.question %}
                                        <p class="govuk-body-s">{{ assembly.question[:100] }}{% if assembly.question|length > 100 %}...{% endif %}</p>
                                    {% endif %}
                                    <dl class="govuk-summary-list govuk-!-margin-bottom-0">
                                        <div class="govuk-summary-list__row">
                                          <dt class="govuk-summary-list__key">{{ _('Created') }}</dt>
                                            <dd class="govuk-summary-list__value">{{ assembly.created_at.strftime('%b %d, %Y') }}</dd>
                                        </div>
                                        {% if assembly.first_assembly_date %}
                                        <div class="govuk-summary-list__row">
                                          <dt class="govuk-summary-list__key">{{ _('Starts') }}</dt>
                                            <dd class="govuk-summary-list__value">{{ assembly.first_assembly_date.strftime('%b %d') }}</dd>
                                        </div>
                                        {% endif %}
                                    </dl>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="govuk-inset-text">
                      <h3 class="govuk-heading-m">{{ _('No assemblies yet') }}</h3>
                      <p class="govuk-body">{{ _("You don't have access to any assemblies at the moment.") }}</p>
                        {% if current_user.global_role.value in ['admin', 'global-organiser'] %}
                        <p class="govuk-body">{{ _('As a %(role)s, you can create new assemblies.', role=current_user.global_role.value) }}</p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
